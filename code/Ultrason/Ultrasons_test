#define ECHO   2 // ECHO -> PIN NUMERIQUE 2    
#define TRIG   3 // TRIG -> PIN NUMERIQUE 3  

int Distance = 0; // Initialisation de Distance à 0

int Distance_test()         // Fonction pour mesurer la distance
{
  digitalWrite(TRIG, LOW);   // Mettre le pin trig en état bas pendant 2us
  delayMicroseconds(2);
  digitalWrite(TRIG, HIGH);  //  Mettre le pin trig en état haut pendant 10us
  delayMicroseconds(10);
  digitalWrite(TRIG, LOW);    // Mettre le pin trig en état bas
  float Fdistance = pulseIn(ECHO, HIGH);  // Lecture du temps à l'état haut du pin echo 
  Fdistance= Fdistance/58;       // Formule datasheet du HCSR04        
  return (int)Fdistance;   // Retour de la valeur en cm
}  

void setup()
{
  Serial.begin(115200);  
  pinMode(ECHO, INPUT);    // Definir pin echo ultrasonique comme entrée
  pinMode(TRIG, OUTPUT);   // Definir pin trig ultrasonique comme sortie
}

void loop()
{
  Distance = Distance_test();                 // Distance à afficher 
  if((2 < Distance) && (Distance < 400))      // Plage de mesure ultrasonique : de 2 cm à 400 cm
  {
    Serial.print("Distance = ");            // Afficher valeur de la distance en cm
    Serial.print(Distance);       
    Serial.println("cm");       
  }
  else
  {
    Serial.println("Hors de portée!");      
  }
  delay(250);
}
